{"ast":null,"code":"// Service modules are where we put our\n// \"business\"/application logic\n// For example, when we signup or log in, \n// we will need to save the token we received \n// from the server - is that type of code\n// good to put in the React component?\n// NO!\nimport * as usersAPI from './users-api';\nexport async function signUp(userData) {\n  // Delegate the request to the users-api\n  // which will ultimatelly return a JSON Web Token (JWT)\n  const token = await usersAPI.signUp(userData); // Persist the token \n\n  localStorage.setItem('token', token);\n  return getUser();\n}\nexport async function login(credentials) {\n  // Delegate the request to the users-api\n  // which will ultimatelly return a JSON Web Token (JWT)\n  const token = await usersAPI.login(credentials); // Persist the token \n\n  localStorage.setItem('token', token);\n  return getUser();\n}\nexport function logOut() {\n  localStorage.removeItem('token');\n} // Return the token if valid, otherwise return null\n\nexport function getToken() {\n  const token = localStorage.getItem('token');\n  if (!token) return null; // Obtain the payload of the token\n  // so that we can check if it's expired\n\n  const payload = JSON.parse(atob(token.split('.')[1]));\n\n  if (payload.exp < Date.now() / 1000) {\n    localStorage.removeItem('token');\n    return null;\n  }\n\n  return token;\n}\nexport function getUser() {\n  const token = getToken();\n  return token ? JSON.parse(atob(token.split('.')[1])).user : null;\n}\nexport function checkToken() {\n  return usersAPI.checkToken().then(dateStr => new Date(dateStr));\n}","map":{"version":3,"names":["usersAPI","signUp","userData","token","localStorage","setItem","getUser","login","credentials","logOut","removeItem","getToken","getItem","payload","JSON","parse","atob","split","exp","Date","now","user","checkToken","then","dateStr"],"sources":["/Users/bencampero/code/project-3-base/src/utilities/users-service.js"],"sourcesContent":["// Service modules are where we put our\n// \"business\"/application logic\n// For example, when we signup or log in, \n// we will need to save the token we received \n// from the server - is that type of code\n// good to put in the React component?\n// NO!\n\nimport * as usersAPI from './users-api';\n\nexport async function signUp(userData) {\n  // Delegate the request to the users-api\n  // which will ultimatelly return a JSON Web Token (JWT)\n  const token = await usersAPI.signUp(userData);\n  // Persist the token \n  localStorage.setItem('token', token);\n  return getUser();\n}\n\nexport async function login(credentials) {\n  // Delegate the request to the users-api\n  // which will ultimatelly return a JSON Web Token (JWT)\n  const token = await usersAPI.login(credentials);\n  // Persist the token \n  localStorage.setItem('token', token);\n  return getUser();\n}\n\nexport function logOut() {\n  localStorage.removeItem('token');\n}\n\n// Return the token if valid, otherwise return null\nexport function getToken() {\n  const token = localStorage.getItem('token');\n  if (!token) return null;\n  // Obtain the payload of the token\n  // so that we can check if it's expired\n  const payload = JSON.parse(atob(token.split('.')[1]));\n  if (payload.exp < Date.now() / 1000) {\n    localStorage.removeItem('token');\n    return null;\n  }\n  return token;\n}\n\nexport function getUser() {\n  const token = getToken();\n  return token ? JSON.parse(atob(token.split('.')[1])).user : null;\n}\n\nexport function checkToken() {\n  return usersAPI.checkToken()\n    .then(dateStr => new Date(dateStr));\n}"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA,OAAO,KAAKA,QAAZ,MAA0B,aAA1B;AAEA,OAAO,eAAeC,MAAf,CAAsBC,QAAtB,EAAgC;EACrC;EACA;EACA,MAAMC,KAAK,GAAG,MAAMH,QAAQ,CAACC,MAAT,CAAgBC,QAAhB,CAApB,CAHqC,CAIrC;;EACAE,YAAY,CAACC,OAAb,CAAqB,OAArB,EAA8BF,KAA9B;EACA,OAAOG,OAAO,EAAd;AACD;AAED,OAAO,eAAeC,KAAf,CAAqBC,WAArB,EAAkC;EACvC;EACA;EACA,MAAML,KAAK,GAAG,MAAMH,QAAQ,CAACO,KAAT,CAAeC,WAAf,CAApB,CAHuC,CAIvC;;EACAJ,YAAY,CAACC,OAAb,CAAqB,OAArB,EAA8BF,KAA9B;EACA,OAAOG,OAAO,EAAd;AACD;AAED,OAAO,SAASG,MAAT,GAAkB;EACvBL,YAAY,CAACM,UAAb,CAAwB,OAAxB;AACD,C,CAED;;AACA,OAAO,SAASC,QAAT,GAAoB;EACzB,MAAMR,KAAK,GAAGC,YAAY,CAACQ,OAAb,CAAqB,OAArB,CAAd;EACA,IAAI,CAACT,KAAL,EAAY,OAAO,IAAP,CAFa,CAGzB;EACA;;EACA,MAAMU,OAAO,GAAGC,IAAI,CAACC,KAAL,CAAWC,IAAI,CAACb,KAAK,CAACc,KAAN,CAAY,GAAZ,EAAiB,CAAjB,CAAD,CAAf,CAAhB;;EACA,IAAIJ,OAAO,CAACK,GAAR,GAAcC,IAAI,CAACC,GAAL,KAAa,IAA/B,EAAqC;IACnChB,YAAY,CAACM,UAAb,CAAwB,OAAxB;IACA,OAAO,IAAP;EACD;;EACD,OAAOP,KAAP;AACD;AAED,OAAO,SAASG,OAAT,GAAmB;EACxB,MAAMH,KAAK,GAAGQ,QAAQ,EAAtB;EACA,OAAOR,KAAK,GAAGW,IAAI,CAACC,KAAL,CAAWC,IAAI,CAACb,KAAK,CAACc,KAAN,CAAY,GAAZ,EAAiB,CAAjB,CAAD,CAAf,EAAsCI,IAAzC,GAAgD,IAA5D;AACD;AAED,OAAO,SAASC,UAAT,GAAsB;EAC3B,OAAOtB,QAAQ,CAACsB,UAAT,GACJC,IADI,CACCC,OAAO,IAAI,IAAIL,IAAJ,CAASK,OAAT,CADZ,CAAP;AAED"},"metadata":{},"sourceType":"module"}