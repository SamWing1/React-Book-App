{"ast":null,"code":"import _regeneratorRuntime from\"/Users/bencampero/code/project-3-base/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/Users/bencampero/code/project-3-base/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";// Service modules are where we put our\n// \"business\"/application logic\n// For example, when we signup or log in, \n// we will need to save the token we received \n// from the server - is that type of code\n// good to put in the React component?\n// NO!\nimport*as usersAPI from'./users-api';export function signUp(_x){return _signUp.apply(this,arguments);}function _signUp(){_signUp=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(userData){var token;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return usersAPI.signUp(userData);case 2:token=_context.sent;// Persist the token \nlocalStorage.setItem('token',token);return _context.abrupt(\"return\",getUser());case 5:case\"end\":return _context.stop();}}},_callee);}));return _signUp.apply(this,arguments);}export function login(_x2){return _login.apply(this,arguments);}function _login(){_login=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(credentials){var token;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return usersAPI.login(credentials);case 2:token=_context2.sent;// Persist the token \nlocalStorage.setItem('token',token);return _context2.abrupt(\"return\",getUser());case 5:case\"end\":return _context2.stop();}}},_callee2);}));return _login.apply(this,arguments);}export function logOut(){localStorage.removeItem('token');}// Return the token if valid, otherwise return null\nexport function getToken(){var token=localStorage.getItem('token');if(!token)return null;// Obtain the payload of the token\n// so that we can check if it's expired\nvar payload=JSON.parse(atob(token.split('.')[1]));if(payload.exp<Date.now()/1000){localStorage.removeItem('token');return null;}return token;}export function getUser(){var token=getToken();return token?JSON.parse(atob(token.split('.')[1])).user:null;}export function checkToken(){return usersAPI.checkToken().then(function(dateStr){return new Date(dateStr);});}","map":{"version":3,"names":["usersAPI","signUp","userData","token","localStorage","setItem","getUser","login","credentials","logOut","removeItem","getToken","getItem","payload","JSON","parse","atob","split","exp","Date","now","user","checkToken","then","dateStr"],"sources":["/Users/bencampero/code/project-3-base/src/utilities/users-service.js"],"sourcesContent":["// Service modules are where we put our\n// \"business\"/application logic\n// For example, when we signup or log in, \n// we will need to save the token we received \n// from the server - is that type of code\n// good to put in the React component?\n// NO!\n\nimport * as usersAPI from './users-api';\n\nexport async function signUp(userData) {\n  // Delegate the request to the users-api\n  // which will ultimatelly return a JSON Web Token (JWT)\n  const token = await usersAPI.signUp(userData);\n  // Persist the token \n  localStorage.setItem('token', token);\n  return getUser();\n}\n\nexport async function login(credentials) {\n  // Delegate the request to the users-api\n  // which will ultimatelly return a JSON Web Token (JWT)\n  const token = await usersAPI.login(credentials);\n  // Persist the token \n  localStorage.setItem('token', token);\n  return getUser();\n}\n\nexport function logOut() {\n  localStorage.removeItem('token');\n}\n\n// Return the token if valid, otherwise return null\nexport function getToken() {\n  const token = localStorage.getItem('token');\n  if (!token) return null;\n  // Obtain the payload of the token\n  // so that we can check if it's expired\n  const payload = JSON.parse(atob(token.split('.')[1]));\n  if (payload.exp < Date.now() / 1000) {\n    localStorage.removeItem('token');\n    return null;\n  }\n  return token;\n}\n\nexport function getUser() {\n  const token = getToken();\n  return token ? JSON.parse(atob(token.split('.')[1])).user : null;\n}\n\nexport function checkToken() {\n  return usersAPI.checkToken()\n    .then(dateStr => new Date(dateStr));\n}"],"mappings":"sQAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA,MAAO,GAAKA,SAAZ,KAA0B,aAA1B,CAEA,eAAsBC,OAAtB,2C,qFAAO,iBAAsBC,QAAtB,oJAGeF,SAAQ,CAACC,MAAT,CAAgBC,QAAhB,CAHf,QAGCC,KAHD,eAIL;AACAC,YAAY,CAACC,OAAb,CAAqB,OAArB,CAA8BF,KAA9B,EALK,gCAMEG,OAAO,EANT,wD,yCASP,eAAsBC,MAAtB,2C,mFAAO,kBAAqBC,WAArB,yJAGeR,SAAQ,CAACO,KAAT,CAAeC,WAAf,CAHf,QAGCL,KAHD,gBAIL;AACAC,YAAY,CAACC,OAAb,CAAqB,OAArB,CAA8BF,KAA9B,EALK,iCAMEG,OAAO,EANT,0D,wCASP,MAAO,SAASG,OAAT,EAAkB,CACvBL,YAAY,CAACM,UAAb,CAAwB,OAAxB,EACD,CAED;AACA,MAAO,SAASC,SAAT,EAAoB,CACzB,GAAMR,MAAK,CAAGC,YAAY,CAACQ,OAAb,CAAqB,OAArB,CAAd,CACA,GAAI,CAACT,KAAL,CAAY,MAAO,KAAP,CACZ;AACA;AACA,GAAMU,QAAO,CAAGC,IAAI,CAACC,KAAL,CAAWC,IAAI,CAACb,KAAK,CAACc,KAAN,CAAY,GAAZ,EAAiB,CAAjB,CAAD,CAAf,CAAhB,CACA,GAAIJ,OAAO,CAACK,GAAR,CAAcC,IAAI,CAACC,GAAL,GAAa,IAA/B,CAAqC,CACnChB,YAAY,CAACM,UAAb,CAAwB,OAAxB,EACA,MAAO,KAAP,CACD,CACD,MAAOP,MAAP,CACD,CAED,MAAO,SAASG,QAAT,EAAmB,CACxB,GAAMH,MAAK,CAAGQ,QAAQ,EAAtB,CACA,MAAOR,MAAK,CAAGW,IAAI,CAACC,KAAL,CAAWC,IAAI,CAACb,KAAK,CAACc,KAAN,CAAY,GAAZ,EAAiB,CAAjB,CAAD,CAAf,EAAsCI,IAAzC,CAAgD,IAA5D,CACD,CAED,MAAO,SAASC,WAAT,EAAsB,CAC3B,MAAOtB,SAAQ,CAACsB,UAAT,GACJC,IADI,CACC,SAAAC,OAAO,QAAI,IAAIL,KAAJ,CAASK,OAAT,CAAJ,EADR,CAAP,CAED"},"metadata":{},"sourceType":"module"}